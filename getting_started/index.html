<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Getting Started | @jmondi/oauth2-server</title>
    <meta name="generator" content="VuePress 1.8.2">
    
    <meta name="description" content="A standards compliant implementation of an OAuth 2.0 authorization server for Node that utilizes JWT and Proof Key for Code Exchange (PKCE), written in TypeScript. ">
    
    <link rel="preload" href="/ts-oauth2-server/assets/css/0.styles.ace02c17.css" as="style"><link rel="preload" href="/ts-oauth2-server/assets/js/app.e4010ef4.js" as="script"><link rel="preload" href="/ts-oauth2-server/assets/js/2.eeb228d0.js" as="script"><link rel="preload" href="/ts-oauth2-server/assets/js/10.ad3b4567.js" as="script"><link rel="preload" href="/ts-oauth2-server/assets/js/5.9e3e377e.js" as="script"><link rel="prefetch" href="/ts-oauth2-server/assets/js/11.0dccd8a1.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/12.f170c7a2.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/13.5dea15c7.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/14.2027debb.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/15.af20fa08.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/16.c3510250.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/17.8342024f.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/18.b1184797.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/19.3ae9f5b8.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/20.a094a67d.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/3.f1044b1b.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/4.2025cade.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/6.59a9b290.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/7.2d4f4db5.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/8.98e2ff65.js"><link rel="prefetch" href="/ts-oauth2-server/assets/js/9.fc013a56.js">
    <link rel="stylesheet" href="/ts-oauth2-server/assets/css/0.styles.ace02c17.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/ts-oauth2-server/" class="home-link router-link-active"><!----> <span class="site-name">@jmondi/oauth2-server</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="https://github.com/jasonraimondi/ts-oauth2-server" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/ts-oauth2-server/getting_started/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Getting Started
</a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <aside class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="https://github.com/jasonraimondi/ts-oauth2-server" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></div><div class="nav-item"><a href="/ts-oauth2-server/getting_started/" aria-current="page" class="nav-link router-link-exact-active router-link-active">
  Getting Started
</a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/ts-oauth2-server/" aria-current="page" class="sidebar-link">TypeScript OAuth2.0 Server</a></li><li><a href="/ts-oauth2-server/getting_started/" aria-current="page" class="active sidebar-link">Getting Started</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/ts-oauth2-server/getting_started/#install" class="sidebar-link">Install</a></li><li class="sidebar-sub-header"><a href="/ts-oauth2-server/getting_started/#the-authorization-server" class="sidebar-link">The Authorization Server</a></li><li class="sidebar-sub-header"><a href="/ts-oauth2-server/getting_started/#the-token-endpoint" class="sidebar-link">The Token Endpoint</a></li><li class="sidebar-sub-header"><a href="/ts-oauth2-server/getting_started/#the-authorize-endpoint" class="sidebar-link">The Authorize Endpoint</a></li></ul></li><li><section class="sidebar-group depth-0"><a href="/ts-oauth2-server/grants/" class="sidebar-heading clickable"><span>Grants</span> <!----></a> <ul class="sidebar-links sidebar-group-items"><li><a href="/ts-oauth2-server/grants/client_credentials.html" class="sidebar-link">Client Credentials Grant</a></li><li><a href="/ts-oauth2-server/grants/authorization_code.html" class="sidebar-link">Authorization Code Grant (w/ PKCE)</a></li><li><a href="/ts-oauth2-server/grants/refresh_token.html" class="sidebar-link">Refresh Token Grant</a></li><li><a href="/ts-oauth2-server/grants/password.html" class="sidebar-link">Password Grant</a></li><li><a href="/ts-oauth2-server/grants/implicit.html" class="sidebar-link">Implicit Grant</a></li></ul></section></li><li><a href="/ts-oauth2-server/repositories/" class="sidebar-link">Repository Interfaces</a></li><li><a href="/ts-oauth2-server/entities/" class="sidebar-link">Entity Interfaces</a></li><li><a href="/ts-oauth2-server/adapters/" class="sidebar-link">Adapters</a></li><li><a href="/ts-oauth2-server/glossary/" class="sidebar-link">Glossary</a></li><li><a href="/ts-oauth2-server/sources/" class="sidebar-link">Sources</a></li></ul> </aside> <main class="page"> <div class="theme-default-content content__default"><h1 id="getting-started"><a href="#getting-started" class="header-anchor">#</a> Getting Started</h1> <h2 id="install"><a href="#install" class="header-anchor">#</a> Install</h2> <p><a href="https://www.npmjs.com/package/@jmondi/oauth2-server" target="_blank" rel="noopener noreferrer"><img src="https://img.shields.io/npm/v/@jmondi/oauth2-server?style=flat-square" alt="npm"><span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <!----> <h2 id="the-authorization-server"><a href="#the-authorization-server" class="header-anchor">#</a> The Authorization Server</h2> <p>The AuthorizationServer depends on <a href="#repositories">the repositories</a>. By default, no grants are enabled; each grant is opt-in and must be enabled when creating the AuthorizationServer.</p> <p>You can enable any grant types you would like to support.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> authorizationServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthorizationServer</span><span class="token punctuation">(</span>
  authCodeRepository<span class="token punctuation">,</span>
  clientRepository<span class="token punctuation">,</span>
  accessTokenRepository<span class="token punctuation">,</span>
  scopeRepository<span class="token punctuation">,</span>
  userRepository<span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">JwtService</span><span class="token punctuation">(</span><span class="token string">&quot;secret-key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
authorizationServer<span class="token punctuation">.</span><span class="token function">enableGrantType</span><span class="token punctuation">(</span><span class="token string">&quot;client_credentials&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorizationServer<span class="token punctuation">.</span><span class="token function">enableGrantType</span><span class="token punctuation">(</span><span class="token string">&quot;authorization_code&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorizationServer<span class="token punctuation">.</span><span class="token function">enableGrantType</span><span class="token punctuation">(</span><span class="token string">&quot;refresh_token&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
authorizationServer<span class="token punctuation">.</span><span class="token function">enableGrantType</span><span class="token punctuation">(</span><span class="token string">&quot;implicit&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// implicit grant is not recommended</span>
authorizationServer<span class="token punctuation">.</span><span class="token function">enableGrantType</span><span class="token punctuation">(</span><span class="token string">&quot;password&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// password grant is not recommended</span>
</code></pre></div><p>The authorization server has a few optional settings with the following default values;</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">type</span> <span class="token class-name">AuthorizationServerOptions</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  requiresPKCE<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
  notBeforeLeeway<span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">;</span>
  tokenCID<span class="token operator">:</span> <span class="token string">&quot;name&quot;</span><span class="token operator">|</span><span class="token string">&quot;id&quot;</span><span class="token punctuation">;</span> <span class="token comment">// in v2.x default is &quot;name&quot;, in 3.x default will be &quot;id&quot;</span>
<span class="token punctuation">}</span>
</code></pre></div><p>To configure these options, pass the value in as the last argument:</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">const</span> authorizationServer <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">AuthorizationServer</span><span class="token punctuation">(</span>
  authCodeRepository<span class="token punctuation">,</span>
  clientRepository<span class="token punctuation">,</span>
  accessTokenRepository<span class="token punctuation">,</span>
  scopeRepository<span class="token punctuation">,</span>
  userRepository<span class="token punctuation">,</span>
  <span class="token keyword">new</span> <span class="token class-name">JwtService</span><span class="token punctuation">(</span><span class="token string">&quot;secret-key&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    requiresPKCE<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span> <span class="token comment">// default is true</span>
    notBeforeLeeway<span class="token operator">:</span> <span class="token number">10</span><span class="token punctuation">,</span> <span class="token comment">// default is 0</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="the-token-endpoint"><a href="#the-token-endpoint" class="header-anchor">#</a> The Token Endpoint</h2> <p>The <code>/token</code> endpoint is a back channel endpoint that issues a useable access token.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code>app<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">&quot;/token&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Express<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Express<span class="token punctuation">.</span>Response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> oauthResponse <span class="token operator">=</span> <span class="token keyword">await</span> authorizationServer<span class="token punctuation">.</span><span class="token function">respondToAccessTokenRequest</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">handleExpressResponse</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> oauthResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleExpressError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="the-authorize-endpoint"><a href="#the-authorize-endpoint" class="header-anchor">#</a> The Authorize Endpoint</h2> <p>The <code>/authorize</code> endpoint is a front channel endpoint that issues an authorization code. The authorization code can then be exchanged to the <code>AuthorizationServer</code> endpoint for a useable access token.</p> <p>The endpoint should redirect the user to login, and then to accept the scopes requested by the application, and only when the user accepts, should it send the user back to the clients redirect uri.</p> <div class="language-typescript extra-class"><pre class="language-typescript"><code><span class="token keyword">import</span> <span class="token punctuation">{</span> requestFromExpress <span class="token punctuation">}</span> <span class="token keyword">from</span> <span class="token string">&quot;@jmondi/oauth2-server/dist/adapters/express&quot;</span><span class="token punctuation">;</span>

app<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">&quot;/authorize&quot;</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>req<span class="token operator">:</span> Express<span class="token punctuation">.</span>Request<span class="token punctuation">,</span> res<span class="token operator">:</span> Express<span class="token punctuation">.</span>Response<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
  <span class="token keyword">try</span> <span class="token punctuation">{</span>
    <span class="token comment">// Validate the HTTP request and return an AuthorizationRequest.</span>
    <span class="token keyword">const</span> authRequest <span class="token operator">=</span> <span class="token keyword">await</span> authorizationServer<span class="token punctuation">.</span><span class="token function">validateAuthorizationRequest</span><span class="token punctuation">(</span>request<span class="token punctuation">,</span> <span class="token function">requestFromExpress</span><span class="token punctuation">(</span>req<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// You will probably redirect the user to a login endpoint. </span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>req<span class="token punctuation">.</span>user<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      req<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/login&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token comment">// After login, the user should be redirected back with user in the session.</span>
    <span class="token comment">// You will need to manage the authorization query on the round trip.</span>
    <span class="token comment">// The auth request object can be serialized and saved into a user's session.</span>

    <span class="token comment">// Once the user has logged in set the user on the AuthorizationRequest</span>
    authRequest<span class="token punctuation">.</span>user <span class="token operator">=</span> req<span class="token punctuation">.</span>user<span class="token punctuation">;</span>
    
    <span class="token comment">// Once the user has approved or denied the client update the status</span>
    <span class="token comment">// (true = approved, false = denied)</span>
    authRequest<span class="token punctuation">.</span>isAuthorizationApproved <span class="token operator">=</span> <span class="token function">getIsAuthorizationApprovedFromSession</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token comment">// If the user has not approved the client's authorization request, </span>
    <span class="token comment">// the user should be redirected to the approval screen.</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>authRequest<span class="token punctuation">.</span>isAuthorizationApproved<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// This form will ask the user to approve the client and the scopes requested.</span>
      <span class="token comment">// &quot;Do you authorize Jason to: read contacts? write contacts?&quot;</span>
      req<span class="token punctuation">.</span><span class="token function">redirect</span><span class="token punctuation">(</span><span class="token string">&quot;/scopes&quot;</span><span class="token punctuation">)</span>
      <span class="token keyword">return</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// At this point the user has approved the client for authorization.</span>
    <span class="token comment">// Any last authorization requests such as Two Factor Authentication (2FA) can happen here.</span>


    <span class="token comment">// Redirect back to redirect_uri with `code` and `state` as url query params.</span>
    <span class="token keyword">const</span> oauthResponse <span class="token operator">=</span> <span class="token keyword">await</span> authorizationServer<span class="token punctuation">.</span><span class="token function">completeAuthorizationRequest</span><span class="token punctuation">(</span>authRequest<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">handleExpressResponse</span><span class="token punctuation">(</span>res<span class="token punctuation">,</span> oauthResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span>e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">handleExpressError</span><span class="token punctuation">(</span>e<span class="token punctuation">,</span> res<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre></div></div> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev">
      ←
      <a href="/ts-oauth2-server/" class="prev router-link-active">
        TypeScript OAuth2.0 Server
      </a></span> <span class="next"><a href="/ts-oauth2-server/grants/client_credentials.html">
        Client Credentials Grant
      </a>
      →
    </span></p></div> </main></div><div class="global-ui"></div></div>
    <script src="/ts-oauth2-server/assets/js/app.e4010ef4.js" defer></script><script src="/ts-oauth2-server/assets/js/2.eeb228d0.js" defer></script><script src="/ts-oauth2-server/assets/js/10.ad3b4567.js" defer></script><script src="/ts-oauth2-server/assets/js/5.9e3e377e.js" defer></script>
  </body>
</html>
